# SPDX-License-Identifier: GPL-2.0
#
# Entropy Source and DRNG Manager configuration
#

config CRYPTO_ESDM
	bool "ESDM Implementation"
	default n
	select CRYPTO_LIB_SHA256 if CRYPTO
	help
	  The Entropy Source and DRNG Manager (ESDM) generates entropy
	  from different entropy sources. Each entropy source can
	  be enabled and configured independently. The interrupt
	  entropy source can be configured to be SP800-90B compliant.
	  The entire ESDM can be configured to be SP800-90C compliant.
	  Runtime-switchable cryptographic support is available.
	  The ESDM delivers significant entropy during boot.

	  The ESDM also provides compliance to SP800-90A/B/C.

menu "Entropy Source and DRNG Manager Configuration"
	depends on CRYPTO_ESDM

if CRYPTO_ESDM

config CRYPTO_ESDM_SHA256
	bool
	default y if CRYPTO_LIB_SHA256

menu "Specific DRNG seeding strategies"

config CRYPTO_ESDM_OVERSAMPLE_ENTROPY_SOURCES
	bool "Oversample entropy sources"
	default n
	help
	  When enabling this option, the entropy sources are
	  over-sampled with the following approach: First, the
	  the entropy sources are requested to provide 64 bits more
	  entropy than the size of the entropy buffer. For example,
	  if the entropy buffer is 256 bits, 320 bits of entropy
	  is requested to fill that buffer.

	  Second, the seed operation of the deterministic RNG
	  requests 128 bits more data from each entropy source than
	  the security strength of the DRNG during initialization.
	  A prerequisite for this operation is that the digest size
	  of the used hash must be at least equally large to generate
	  that buffer. If the prerequisite is not met, this
	  oversampling is not applied.

	  This strategy is intended to offset the asymptotic entropy
	  increase to reach full entropy in a buffer.

	  The strategy is consistent with the requirements in
	  NIST SP800-90C and is only enforced with fips=1.

	  If unsure, say N.

config CRYPTO_ESDM_OVERSAMPLE_ES_BITS
	int
	default 0 if !CRYPTO_ESDM_OVERSAMPLE_ENTROPY_SOURCES
	default 64 if CRYPTO_ESDM_OVERSAMPLE_ENTROPY_SOURCES

config CRYPTO_ESDM_SEED_BUFFER_INIT_ADD_BITS
	int
	default 0 if !CRYPTO_ESDM_OVERSAMPLE_ENTROPY_SOURCES
	default 128 if CRYPTO_ESDM_OVERSAMPLE_ENTROPY_SOURCES

endmenu # "Specific DRNG seeding strategies"

config CRYPTO_ESDM_DRNG_KCAPI
	bool
	depends on CRYPTO
	select CRYPTO_RNG
	default y

endif # CRYPTO_ESDM

endmenu # CRYPTO_ESDM
