# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/net/dsa/nxp,sja1105.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: NXP SJA1105 Automotive Ethernet Switch Family Device Tree Bindings

description:
  The SJA1105 SPI interface requires a CS-to-CLK time (t2 in UM10944.pdf) of at
  least one half of t_CLK. At an SPI frequency of 1MHz, this means a minimum
  cs_sck_delay of 500ns. Ensuring that this SPI timing requirement is observed
  depends on the SPI bus master driver.

allOf:
  - $ref: "dsa.yaml#"

maintainers:
  - Vladimir Oltean <vladimir.oltean@nxp.com>

properties:
  compatible:
    oneOf:
      - enum:
          - nxp,sja1105e
          - nxp,sja1105t
          - nxp,sja1105p
          - nxp,sja1105q
          - nxp,sja1105r
          - nxp,sja1105s

  reg:
    maxItems: 1

patternProperties:
  "^(ethernet-)?ports$":
    type: object

    patternProperties:
      "^(ethernet-)?port@[0-9]+$":
        type: object
        properties:

          # By default (unless otherwise specified) a port is configured as MAC
          # if it is driving a PHY (phy-handle is present) or as PHY if it is
          # PHY-less (fixed-link specified, presumably because it is connected
          # to a MAC). It is suggested to not use these bindings unless an
          # explicit override is necessary (for example, if SJA1105 ports are at
          # both ends of a MII/RMII PHY-less setup. In that case, one end would
          # need to have sja1105,role-mac, and the other sja1105,role-phy).
          sja1105,role-mac:
            $ref: /schemas/types.yaml#/definitions/flag
            description:
                Specifies whether the SJA1105 port is a clock source or sink
                for this interface, according to the applicable standard
                (applicable for MII and RMII, but not applicable for RGMII
                where there are separate TX and RX clocks). In the case of
                RGMII it affects the behavior regarding internal delays.
                If the port is configured in the role of an RGMII MAC, it will
                let the PHY apply internal RGMII delays according to the
                phy-mode property, otherwise it will apply the delays itself.

          sja1105,role-phy:
            $ref: /schemas/types.yaml#/definitions/flag
            description:
                See sja1105,role-mac.

required:
  - compatible
  - reg

unevaluatedProperties: false

examples:
  - |
    spi {
        #address-cells = <1>;
        #size-cells = <0>;

        ethernet-switch@1 {
            reg = <0x1>;
            #address-cells = <1>;
            #size-cells = <0>;
            compatible = "nxp,sja1105t";

            ethernet-ports {
                #address-cells = <1>;
                #size-cells = <0>;

                port@0 {
                    phy-handle = <&rgmii_phy6>;
                    phy-mode = "rgmii-id";
                    reg = <0>;
                    /* Implicit "sja1105,role-mac;" */
                };

                port@1 {
                    phy-handle = <&rgmii_phy3>;
                    phy-mode = "rgmii-id";
                    reg = <1>;
                    /* Implicit "sja1105,role-mac;" */
                };

                port@2 {
                    phy-handle = <&rgmii_phy4>;
                    phy-mode = "rgmii-id";
                    reg = <2>;
                    /* Implicit "sja1105,role-mac;" */
                };

                port@3 {
                    phy-mode = "rgmii-id";
                    reg = <3>;
                };

                port@4 {
                    ethernet = <&enet2>;
                    phy-mode = "rgmii";
                    reg = <4>;
                    /* Implicit "sja1105,role-phy;" */

                    fixed-link {
                        speed = <1000>;
                        full-duplex;
                    };
                };
            };
        };
    };
