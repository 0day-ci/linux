# SPDX-License-Identifier: (GPL-2.0 OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/spmi/qcom,spmi-pmic-arb.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Qualcomm SPMI PMIC Arbiter

maintainers:
  - Fenglin Wu <quic_fenglinw@quicinc.com>
  - Subbaraman Narayanamurthy <quic_subbaram@quicinc.com>

description: |
  The SPMI PMIC Arbiter is found on Snapdragon chipsets. It is an SPMI
  controller with wrapping arbitration logic to allow for multiple
  on-chip devices to control a single SPMI master.

  The PMIC Arbiter can also act as an interrupt controller, providing
  interrupts to slave devices.

  See Documentation/devicetree/bindings/spmi/spmi.yaml for the generic
  SPMI controller binding requirements for child nodes.

allOf:
  - $ref: spmi.yaml#

properties:
  $nodename:
    pattern: "^spmi@.*"

  compatible:
    const: qcom,spmi-pmic-arb

  reg-names:
    oneOf:
      - items:
          - const: core
          - const: intr
          - const: cnfg
      - items:
          - const: core
          - const: intr
          - const: cnfg
          - const: chnls
          - const: obsrvr

  reg:
    minItems: 3
    maxItems: 5
    description: |
      Specifies base physical address and size of the registers in SPMI PMIC
      Arbiter HW module, with the following order.
        - SPMI PMIC arbiter core registers (core)
        - SPMI PMIC arbiter interrupt controller registers (intr)
        - SPMI PMIC arbiter configuration registers (cnfg)
        - SPMI PMIC arbiter tx-channel per virtual slave registers (chnls)
        - SPMI PMIC arbiter rx-channel per virtual slave registers (obsrvr).
      Register for "chnls" and "obsrvr" are only applicable for PMIC arbiter
      with HW version greater than V2.

  "#address-cells":
    const: 2

  "#size-cells":
    const: 0

  interrupts:
    description: The summary interrupt for the PMIC Arb controller.
    maxItems: 1

  interrupt-names:
    const: periph_irq

  interrupt-controller: true

  "#interrupt-cells":
    const: 4
    description: |
      Specifies the number of cells needed to encode any interrupt source.
      The 1st cell is the slave ID for the requested interrupt, its valid
      range is [0-15].
      The 2nd cell is the  peripheral ID for requested interrupt, its valid
      range is [0-255].
      The 3rd cell is the requested peripheral interrupt, its valid range
      is [0-7].
      The 4th cell is interrupt flags indicating level-sense information,
      as defined in dt-bindings/interrupt-controller/irq.h

  qcom,ee:
    description: the active Execution Environment identifier
    $ref: /schemas/types.yaml#/definitions/uint32
    enum: [0, 1, 2, 3, 4, 5]

  qcom,channel:
    description: which of the PMIC Arbiter provided channels to use for accesses
    $ref: /schemas/types.yaml#/definitions/uint32
    enum: [0, 1, 2, 3, 4, 5]

required:
  - compatible
  - reg-names
  - reg
  - "#address-cells"
  - "#size-cells"
  - qcom,ee
  - qcom,channel

additionalProperties: false

examples:
  - |
    spmi@fc4cf000 {
          compatible = "qcom,spmi-pmic-arb";
          reg-names = "core", "intr", "cnfg";
          reg = <0xfc4cf000 0x1000>,
                <0xfc4cb000 0x1000>,
                <0xfc4ca000 0x1000>;
          interrupt-names = "periph_irq";
          interrupts = <0 190 0>;
          interrupt-controller;
          #interrupt-cells = <4>;

          qcom,ee = <0>;
          qcom,channel = <0>;

          #address-cells = <2>;
          #size-cells = <0>;
    };
