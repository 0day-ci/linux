# SPDX-License-Identifier: GPL-2.0
%YAML 1.2
---
$id: http://devicetree.org/schemas/spmi/qcom,spmi-pmic-arb.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Qualcomm SPMI Controller (PMIC Arbiter)

maintainers:
  - Bjorn Andersson <bjorn.andersson@linaro.org>

description: |
  The SPMI PMIC Arbiter is found on Snapdragon chipsets. It is an SPMI
  controller with wrapping arbitration logic to allow for multiple on-chip
  devices to control a single SPMI master.

  The PMIC Arbiter can also act as an interrupt controller, providing
  interrupts to slave devices. See
  Documentation/devicetree/bindings/spmi/spmi.yaml for the generic SPMI
  controller binding requirements for child nodes. See
  Documentation/devicetree/bindings/interrupt-controller/interrupts.txt for
  generic interrupt controller binding documentation.

allOf:
  - $ref: spmi.yaml#

properties:

  $nodename:
    pattern: "spmi@[0-9a-f]"

  compatible:
    const: qcom,spmi-pmic-arb

  reg:
    minItems: 3
    items:
      - description: SPMI core registers
      - description: SPMI interrupt controller registers
      - description: SPMI configuration registers
      - description: SPMI tx-channel per virtual slave registers, for V2 PMIC Arbiter
      - description: SPMI rx-channel (called observer) per virtual slave registers, for V2 PMIC Arbiter

  reg-names:
    minItems: 3
    items:
      - const: core
      - const: intr
      - const: cnfg
      - const: chnls
      - const: obsrvr

  interrupts:
    maxItems: 1

  interrupt-names:
    items:
      - const: periph_irq

  qcom,ee:
    description: |
      indicates the active Execution Environment identifier. Valid values 0 to 5
    $ref: /schemas/types.yaml#/definitions/uint32-array

  qcom,channel:
    description: |
      PMIC Arb which provides channels to use for accesses. Valid values 0 to 5
    $ref: /schemas/types.yaml#/definitions/uint32-array

required:
  - compatible
  - reg
  - reg-names
  - interrupts
  - interrupt-names
  - qcom,ee
  - qcom,channel

patternProperties:
  "@[0-9a-f]$":
    type: object

    description: |
      PMIC properties, which are specific to the used SPMI PMIC device(s).

unevaluatedProperties: false

examples:
  - |
    bus {
      #address-cells = <2>;
      #size-cells = <2>;

      spmi: spmi@fff24000 {
        compatible = "qcom,spmi-pmic-arb";
        #address-cells = <2>;
        #size-cells = <0>;
        reg-names = "core", "intr", "cnfg";
        reg = <0x0 0xfc4cf000 0x0 0x1000>,
              <0x0 0xfc4cb000 0x0 0x1000>,
              <0x0 0xfc4ca000 0x0 0x1000>;

        interrupt-names = "periph_irq";
        interrupts = <0 190 0>;

        qcom,ee = <0>;
        qcom,channel = <0>;

        pmic@0 {
          reg = <0 0>;
          /* pmic properties */
        };
      };
    };
