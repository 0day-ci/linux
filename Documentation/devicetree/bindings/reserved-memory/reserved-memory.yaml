# SPDX-License-Identifier: GPL-2.0
%YAML 1.2
---
$id: http://devicetree.org/schemas/reserved-memory/reserved-memory.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: /reserved-memory Node

maintainers:
  - Devicetree Specification Mailing List <devicetree-spec@vger.kernel.org>

description: >
  Reserved memory is specified as a node under the /reserved-memory node. The
  operating system shall exclude reserved memory from normal usage one can
  create child nodes describing particular reserved (excluded from normal use)
  memory regions. Such memory regions are usually designed for the special
  usage by various device drivers.

properties:
  $nodename:
    const: reserved-memory

  "#address-cells": true
  "#size-cells": true
  ranges: true

patternProperties:
  "^(?!(ranges))[a-z,-]*(@[0-9]+)?$":
    type: object

    description: >
      Each child of the reserved-memory node specifies one or more regions of
      reserved memory. Each child node may either use a 'reg' property to
      specify a specific range of reserved memory, or a 'size' property with
      optional constraints to request a dynamically allocated block of memory.

      Following the generic-names recommended practice, node names should
      reflect the purpose of the node (ie. "framebuffer" or "dma-pool"). Unit
      address (@<address>) should be appended to the name if the node is a
      static allocation.

    properties:
      reg: true

      size:
        $ref: /schemas/types.yaml#/definitions/uint32-array
        description: >
          Length based on parent's \#size-cells. Size in bytes of memory to
          reserve.

      alignment:
        $ref: /schemas/types.yaml#/definitions/uint32-array
        description: >
          Length based on parent's \#size-cells. Address boundary for
          alignment of allocation.

      alloc-ranges:
        $ref: /schemas/types.yaml#/definitions/uint32-array
        description: >
          Address and Length pairs. Specifies regions of memory that are
          acceptable to allocate from.

      compatible:
        oneOf:
          - const: shared-dma-pool
            description: >
              This indicates a region of memory meant to be used as a shared
              pool of DMA buffers for a set of devices. It can be used by an
              operating system to instantiate the necessary pool management
              subsystem if necessary.

          # Vendor-specific compatibles in the form <vendor>,[<device>-]<usage>
          - const: mediatek,trustzone-bootinfo

      no-map:
        type: boolean
        description: >
          Indicates the operating system must not create a virtual mapping of
          the region as part of its standard mapping of system memory, nor
          permit speculative access to it under any circumstances other than
          under the control of the device driver using the region.

      reusable:
        type: boolean
        description: >
          The operating system can use the memory in this region with the
          limitation that the device driver(s) owning the region need to be
          able to reclaim it back. Typically that means that the operating
          system can use that region to store volatile or cached data that
          can be otherwise regenerated or migrated elsewhere.

      linux,cma-default:
        type: boolean
        description: >
          If this property is present, then Linux will use the region for the
          default pool of the contiguous memory allocator.

      linux,dma-default:
        type: boolean
        description: >
          If this property is present, then Linux will use the region for the
          default pool of the consistent DMA allocator.

    allOf:
      - if:
          required:
            - no-map

        then:
          not:
            required:
              - reusable

      - if:
          required:
            - reusable

        then:
          not:
            required:
              - no-map

    oneOf:
      - required:
          - reg

      - required:
          - size

    additionalProperties: true

additionalProperties: true

examples:
  - |
      / {
          #address-cells = <1>;
          #size-cells = <1>;
          model = "MediaTek MT2701 evaluation board";
          compatible = "mediatek,mt2701-evb", "mediatek,mt2701";

          reserved-memory {
              #address-cells = <1>;
              #size-cells = <1>;
              ranges;

              /* global autoconfigured region for contiguous allocations */
              linux,cma {
                  compatible = "shared-dma-pool";
                  reusable;
                  size = <0x4000000>;
                  alignment = <0x2000>;
                  linux,cma-default;
              };

              display_reserved: framebuffer@78000000 {
                  reg = <0x78000000 0x800000>;
              };

              trustzone-bootinfo@80002000 {
                  compatible = "mediatek,trustzone-bootinfo";
                  reg = <0x80002000 0x1000>;
              };
          };
      };

...
