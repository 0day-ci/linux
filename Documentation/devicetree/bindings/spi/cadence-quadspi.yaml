# SPDX-License-Identifier: GPL-2.0-only
%YAML 1.2
---
$id: http://devicetree.org/schemas/spi/cadence-quadspi.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Cadence Quad SPI controller

maintainers:
  - Ramuthevar Vadivel Murugan <vadivel.muruganx.ramuthevar@linux.intel.com>
  - Brad Larson <brad@pensando.io>

properties:
  compatible:
    contains:
      enum:
        - cdns,qspi-nor       # Generic default
        - ti,k2g-qspi         # TI 66AK2G SoC
        - ti,am654-ospi       # TI AM654 SoC
        - intel,lgm-qspi      # Intel LGM SoC
        - pensando,cdns-qspi  # Pensando Elba SoC

  '#address-cells':
    const: 1

  '#size-cells':
    const: 0

  reg:
    minItems: 2
    maxItems: 2
    description: |
      Contains two entries, each of which is a tuple consisting of a
      physical address and length. The first entry is the address and
      length of the controller register set. The second entry is the
      address and length of the QSPI Controller data area.

  interrupts:
    maxItems: 1
    description: Unit interrupt specifier for the controller interrupt

  clocks:
    description: phandle to the Quad SPI clock

  cdns,fifo-depth:
    $ref: /schemas/types.yaml#/definitions/uint32
    description: Size of the data FIFO in words

  cdns,fifo-width:
    $ref: /schemas/types.yaml#/definitions/uint32
    description: Bus width of the data FIFO in bytes

  cdns,trigger-address:
    $ref: /schemas/types.yaml#/definitions/uint32
    description: 32-bit indirect AHB trigger address

  cdns,is-decoded-cs:
    $ref: /schemas/types.yaml#/definitions/flag
    description: Flag to indicate whether decoder is used or not

  cdns,rclk-en:
    description:
      Flag to indicate that QSPI return clock is used to latch the
      read data rather than the QSPI clock. Make sure that QSPI return
      clock is populated on the board before using this property
    $ref: /schemas/types.yaml#/definitions/flag

  # Subnodes of the Cadence Quad SPI controller are spi slave nodes 
  # with additional custom properties
  cdns,read-delay:
    $ref: /schemas/types.yaml#/definitions/uint32
    description: Delay for read capture logic, in clock cycles

  cdns,tshsl-ns:
    $ref: /schemas/types.yaml#/definitions/uint32
    description:
      Delay in nanoseconds for the length that the master mode chip
      select outputs are de-asserted between transactions

  cdns,tsd2d-ns:
    $ref: /schemas/types.yaml#/definitions/uint32
    description:
      Delay in nanoseconds between one chip select being de-activated
      and the activation of another.

  cdns,tchsh-ns:
    $ref: /schemas/types.yaml#/definitions/uint32
    description:
      Delay in nanoseconds between last bit of current transaction and
      deasserting the device chip select (qspi_n_ss_out).

  cdns,tslch-ns:
    $ref: /schemas/types.yaml#/definitions/uint32
    description:
      Delay in nanoseconds between setting qspi_n_ss_out low and first
      bit transfer.

  resets:
    items:
      - description: qspi reset
      - description: qspi-ocp reset

  reset-names:
    items:
      - const: qspi
      - const: qspi-ocp

required:
  - compatible
  - reg
  - interrupts
  - clocks
  - cdns,fifo-depth
  - cdns,fifo-width
  - cdns,trigger-address

patternProperties:
  "^.*@[0-9]+$":
    type: object

additionalProperties: false

examples:
  - |
    #include <dt-bindings/reset/altr,rst-mgr-a10.h>
    qspi: spi@ff705000 {
        compatible = "cdns,qspi-nor";
        #address-cells = <1>;
        #size-cells = <0>;
        reg = <0xff705000 0x1000>,
              <0xffa00000 0x1000>;
        interrupts = <0 151 4>;
        clocks = <&qspi_clk>;
        cdns,is-decoded-cs;
        cdns,fifo-depth = <128>;
        cdns,fifo-width = <4>;
        cdns,trigger-address = <0x00000000>;
        resets = <&rst QSPI_RESET>, <&rst QSPI_OCP_RESET>;
        reset-names = "qspi", "qspi-ocp";

        flash0: mt25q@0 {
                compatible = "jdec,spi-nor";
                reg = <0>;
                spi-max-frequency = <40000000>;
                spi-rx-bus-width = <2>;
                m25p,fast-read;
                cdns,read-delay = <0>;
                cdns,tshsl-ns = <0>;
                cdns,tsd2d-ns = <0>;
                cdns,tchsh-ns = <0>;
                cdns,tslch-ns = <0>;
        };
    };
